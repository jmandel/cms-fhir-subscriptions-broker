<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 750 720" width="750" height="720">
  <rect width="750" height="720" fill="white"/>
  <defs>
    <style>
      .actor-label { font-family: Inter, 'Segoe UI', system-ui, sans-serif; font-size: 12px; font-weight: 600; text-anchor: middle; fill: #1e293b; }
      .msg-label { font-family: Inter, 'Segoe UI', system-ui, sans-serif; font-size: 11px; fill: #334155; }
      .msg-label-gray { font-family: Inter, 'Segoe UI', system-ui, sans-serif; font-size: 11px; fill: #64748b; font-style: italic; }
      .phase-label { font-family: Inter, 'Segoe UI', system-ui, sans-serif; font-size: 10px; font-weight: 600; fill: #94a3b8; letter-spacing: 0.08em; text-transform: uppercase; }
      .lifeline { stroke: #cbd5e1; stroke-width: 1; stroke-dasharray: 6 4; }
      .arrow-solid { stroke: #334155; stroke-width: 1.5; fill: none; marker-end: url(#arrowSolid); }
      .arrow-dashed { stroke: #94a3b8; stroke-width: 1.5; fill: none; stroke-dasharray: 6 3; marker-end: url(#arrowDashed); }
    </style>
    <marker id="arrowSolid" viewBox="0 0 10 8" refX="9" refY="4" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0.5 L9,4 L0,7.5 z" fill="#334155"/>
    </marker>
    <marker id="arrowDashed" viewBox="0 0 10 8" refX="9" refY="4" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
      <path d="M0,0.5 L9,4 L0,7.5 z" fill="#94a3b8"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="750" height="720" fill="#ffffff" rx="4"/>

  <!-- ============ ACTOR BOXES ============ -->
  <!-- Client x=120 -->
  <rect x="70" y="20" width="100" height="36" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="1.5"/>
  <text x="120" y="43" class="actor-label">Client</text>

  <!-- Broker x=300 -->
  <rect x="250" y="20" width="100" height="36" rx="6" fill="#f0fdf4" stroke="#22c55e" stroke-width="1.5"/>
  <text x="300" y="43" class="actor-label">Broker</text>

  <!-- Data Source x=500 -->
  <rect x="445" y="20" width="110" height="36" rx="6" fill="#fefce8" stroke="#eab308" stroke-width="1.5"/>
  <text x="500" y="43" class="actor-label">Data Source</text>

  <!-- Peer Network x=675 -->
  <rect x="620" y="20" width="110" height="36" rx="6" fill="#f5f3ff" stroke="#8b5cf6" stroke-width="1.5"/>
  <text x="675" y="43" class="actor-label">Peer Network</text>

  <!-- ============ LIFELINES ============ -->
  <line x1="120" y1="56" x2="120" y2="710" class="lifeline"/>
  <line x1="300" y1="56" x2="300" y2="710" class="lifeline"/>
  <line x1="500" y1="56" x2="500" y2="710" class="lifeline"/>
  <line x1="675" y1="56" x2="675" y2="710" class="lifeline"/>

  <!-- ============ PHASE: AUTHORIZATION  y=80 ============ -->
  <line x1="20" y1="80" x2="730" y2="80" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4 3"/>
  <text x="28" y="93" class="phase-label">Authorization</text>

  <!-- Step 1: Client → Broker  arrow y=118 -->
  <text x="132" y="112" class="msg-label">Token request (identity + consent context)</text>
  <line x1="120" y1="118" x2="300" y2="118" class="arrow-solid"/>

  <!-- Step 2: Broker → Client  arrow y=160 -->
  <text x="132" y="154" class="msg-label">Access token {patient: broker-123}</text>
  <line x1="300" y1="160" x2="120" y2="160" class="arrow-solid"/>

  <!-- ============ PHASE: SUBSCRIPTION  y=192 ============ -->
  <line x1="20" y1="192" x2="730" y2="192" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4 3"/>
  <text x="28" y="205" class="phase-label">Subscription</text>

  <!-- Step 3: Client → Broker  arrow y=230 -->
  <text x="160" y="224" class="msg-label">POST /Subscription</text>
  <line x1="120" y1="230" x2="300" y2="230" class="arrow-solid"/>

  <!-- Step 4: Broker → Client  arrow y=272 -->
  <text x="132" y="266" class="msg-label">201 Created {status: active}</text>
  <line x1="300" y1="272" x2="120" y2="272" class="arrow-solid"/>

  <!-- ============ PHASE: NETWORK SETUP  y=304 ============ -->
  <line x1="20" y1="304" x2="730" y2="304" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4 3"/>
  <text x="28" y="317" class="phase-label">Network Setup</text>

  <!-- Step 5: Broker → Data Source  arrow y=342 -->
  <text x="340" y="336" class="msg-label-gray">Arrange event feeds</text>
  <line x1="300" y1="342" x2="500" y2="342" class="arrow-dashed"/>

  <!-- Step 6: Broker → Peer Network  arrow y=384 -->
  <text x="400" y="378" class="msg-label-gray">Register for peer events</text>
  <line x1="300" y1="384" x2="675" y2="384" class="arrow-dashed"/>

  <!-- ============ PHASE: NOTIFICATION  y=416 ============ -->
  <line x1="20" y1="416" x2="730" y2="416" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4 3"/>
  <text x="28" y="429" class="phase-label">Notification</text>

  <!-- Step 7: Data Source → Broker  arrow y=454 -->
  <text x="340" y="448" class="msg-label-gray">Event (ADT / FHIR / …)</text>
  <line x1="500" y1="454" x2="300" y2="454" class="arrow-dashed"/>

  <!-- Step 8: Broker → Client  arrow y=496 -->
  <text x="122" y="490" class="msg-label">POST notification {focus: Data Source URL}</text>
  <line x1="300" y1="496" x2="120" y2="496" class="arrow-solid"/>

  <!-- Step 9: Client → Broker  arrow y=538 -->
  <text x="192" y="532" class="msg-label">200 OK</text>
  <line x1="120" y1="538" x2="300" y2="538" class="arrow-solid"/>

  <!-- ============ PHASE: DATA RETRIEVAL  y=570 ============ -->
  <line x1="20" y1="570" x2="730" y2="570" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4 3"/>
  <text x="28" y="583" class="phase-label">Data Retrieval</text>

  <!-- Step 10: Client → Data Source  arrow y=608 -->
  <text x="262" y="602" class="msg-label">Token request</text>
  <line x1="120" y1="608" x2="500" y2="608" class="arrow-solid"/>

  <!-- Step 11: Data Source → Client  arrow y=640 (reduced to 32px gap for tighter fit) -->
  <text x="274" y="634" class="msg-label">Access token</text>
  <line x1="500" y1="640" x2="120" y2="640" class="arrow-solid"/>

  <!-- Step 12: Client → Data Source  arrow y=672 -->
  <text x="218" y="666" class="msg-label">GET /Encounter/enc-98765</text>
  <line x1="120" y1="672" x2="500" y2="672" class="arrow-solid"/>

  <!-- Step 13: Data Source → Client  arrow y=700 (reduced spacing to fit) -->
  <text x="260" y="696" class="msg-label">Encounter resource</text>
  <line x1="500" y1="702" x2="120" y2="702" class="arrow-solid"/>

</svg>